# Admin Authentication
# Password for admin access to content management features
# SECURITY: Use a strong password with at least 16 characters, including uppercase, lowercase, numbers, and special characters
# Example: Generate with: openssl rand -base64 32
ADMIN_PASSWORD=CHANGE_ME_USE_STRONG_PASSWORD_MIN_16_CHARS

# Session Secret for signing session tokens
# SECURITY: Use a separate secret independent of ADMIN_PASSWORD
# This secret is used to sign session cookies with HMAC-SHA256
# If not set, falls back to ADMIN_PASSWORD (not recommended for production)
# Example: Generate with: openssl rand -base64 32
SESSION_SECRET=CHANGE_ME_GENERATE_RANDOM_32BYTE_SECRET

# GitHub Integration
# Personal access token for GitHub API integration
# FORMAT: Token must start with 'ghp_' followed by 36 characters (GitHub Personal Access Token)
#         or 'github_pat_' for fine-grained tokens
# 
# Required Scopes:
# - For Classic Tokens: 'repo' (full repository access)
# - For Fine-Grained Tokens: 'Contents: Read & write', 'Pull requests: Read & write', 'Metadata: Read-only'
# 
# The admin commit workflow requires these permissions to:
# 1. Read universe.json from the repository (to fetch current SHA and content)
# 2. Commit updated universe.json after disk saves
# 3. Create branches and pull requests (if using PR-based workflow)
# 
# Generate Classic Token at: https://github.com/settings/tokens/new
# Generate Fine-Grained Token at: https://github.com/settings/personal-access-tokens/new
GITHUB_TOKEN=ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# GitHub repository information (auto-detected on Vercel)
# Format: owner/repo (e.g., 'AgentFoundryExamples/the-horizon')
GITHUB_OWNER=AgentFoundryExamples
GITHUB_REPO=the-horizon
GITHUB_BRANCH=main

# Universe Data Configuration
# Optional: Custom path for universe data file (defaults to public/universe/universe.json)
# Use this to specify a different location for the universe.json file
# UNIVERSE_DATA_PATH=public/universe/universe.json

# Logging Configuration
# Enable verbose logging for admin and GitHub workflows (useful for debugging)
# Added in v0.1.5 to provide detailed SHA refresh tracking and workflow step logging
# Set to 'true' to enable detailed step-by-step logging including:
# - SHA fetch operations with hash previews
# - File read operations with byte counts
# - Workflow step separators for easier log parsing
# - GitHub API interaction details
# In production, leave unset or set to 'false' to reduce log noise
# ADMIN_VERBOSE_LOGGING=false
# GITHUB_VERBOSE_LOGGING=false
# Note: Verbose logging is automatically enabled in NODE_ENV=development

# v0.1.7 Note: No new environment variables added for hover label stabilization (ISS-1)
# or breadcrumb navigation enhancements (ISS-2). All features work with existing configuration.

# Next.js Configuration
# Set to production for production builds
NODE_ENV=development

# API Keys
# Add any future API keys here
# Example: NEXT_PUBLIC_API_KEY=your-api-key

# Database Configuration (future)
# DATABASE_URL=postgresql://user:password@localhost:5432/horizon

# Admin Save Workflow Configuration
# The admin interface uses a two-step workflow to ensure data integrity:
# 1. PATCH /api/admin/universe - Saves changes to local file system (universe.json)
# 2. POST /api/admin/universe - Commits saved file to GitHub (requires GITHUB_TOKEN)
#
# Commit Workflow Details:
# - The system always fetches fresh SHA from GitHub before committing
# - This prevents "file has changed" errors after disk saves
# - If GitHub HEAD has changed since you loaded the editor, you'll get a conflict error
# - In case of conflict: refresh the page, re-apply changes, save, then commit
# 
# GET Endpoint Behavior:
# - By default, GET /api/admin/universe reads from the local file system
# - This prevents GitHub fetches from overwriting unsaved local edits
# - To explicitly sync from GitHub, use GET /api/admin/universe?syncFromGitHub=true
# - GitHub sync is useful when multiple admins are working and you want the latest committed version
#
# Manual Verification Steps:
# 1. After saving: Check that public/universe/universe.json has been updated with your changes
# 2. After committing: Check GitHub repository for the commit or PR
# 3. Monitor server logs for [PATCH /api/admin/universe] and [POST /api/admin/universe] messages
# 4. Test the full workflow locally before deploying to production
#
# Required Environment Variables for Full Workflow:
# - ADMIN_PASSWORD: Required for authentication
# - SESSION_SECRET: Recommended for production (falls back to ADMIN_PASSWORD if not set)
# - GITHUB_TOKEN: Required ONLY for committing to GitHub (step 2)
# - GITHUB_OWNER: Required ONLY for committing to GitHub (step 2)
# - GITHUB_REPO: Required ONLY for committing to GitHub (step 2)
#
# Note: You can test the save workflow (step 1) without GitHub credentials.
# GitHub credentials are only needed when committing changes (step 2).
#
# Optimistic Locking & Conflict Resolution:
# - Each save/load operation includes a content hash for optimistic locking
# - This prevents concurrent admins from overwriting each other's changes
# - The system fetches fresh SHA from GitHub right before committing
# - If a conflict is detected (hash mismatch), the API returns 409 Conflict
# - Conflict resolution: refresh page → re-apply changes → save to disk → commit
# - The commit will fail with retry guidance if GitHub HEAD changed after your save
#
# Error Handling & Retry Guidance:
# - "Conflict detected" (409): File modified by another user or admin
#   → Refresh, re-apply changes, save, then commit
# - "No saved data found" (400): Must save to disk before committing
#   → Click "Save to Disk" first, then "Commit to GitHub"
# - "Authentication failed" (401): Invalid or expired GitHub token
#   → Check GITHUB_TOKEN environment variable
# - "Permission denied" (403): Token lacks required permissions
#   → Ensure token has 'repo' scope or 'Contents: Read & write' for fine-grained tokens

# Note: Never commit actual secrets to version control
# Copy this file to .env.local and add your real values there
